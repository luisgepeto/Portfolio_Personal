{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/predict-energy-demand-machine-learning-architecture","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 562px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABJ0AAASdAHeZh94AAABVklEQVQY02NQ71kBRBo9K+Tal0q3LYFw1UAiqzR6VmqAubgQA4RS7lqeveFI3c7Tmj2r1LtXavauVOpYrty5SrVzjUb3WvXuNUAEZIDZEAQSAWkGKpVsXbTk3O3jD17KtCw36F8Xs3xv2OLdQQt3ec3dodQBNG6tWvdq1e5VKl2rgCQQqfesBiIGoMNUupfrTVi9//bTJ+8/20/fArTZZ/52jzlbPeZus5ux0XDiWv0JawwnrjOetM5k8jqTSeuAIpq9QM2rGIDWyrYvadx9bvX5uzOPXJ5x7Kpmz2qvudvcZ291nLnZfsYmoCmWUze4z9nqM2+H/fRNzjM3e83ZpjdhrWr3SpCzVbuXO8/e4jl3q9ucLR5zt2qAnLdCrWulWtcK1a6VKt0rVcFIBYK6gCECDMtVIJshAabQsRSIFDuXyXcshQQ+PEiBYa4OVqoBQ2ogP4MQAAcAzRZ2xelxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5ce704f4f04a15bfee13264103ea3402/ba381/azure-ml-studio-logo.webp 200w,\n/static/5ce704f4f04a15bfee13264103ea3402/7f61c/azure-ml-studio-logo.webp 400w,\n/static/5ce704f4f04a15bfee13264103ea3402/49232/azure-ml-studio-logo.webp 562w\"\n              sizes=\"(max-width: 562px) 100vw, 562px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5ce704f4f04a15bfee13264103ea3402/772e8/azure-ml-studio-logo.png 200w,\n/static/5ce704f4f04a15bfee13264103ea3402/e17e5/azure-ml-studio-logo.png 400w,\n/static/5ce704f4f04a15bfee13264103ea3402/6e88f/azure-ml-studio-logo.png 562w\"\n            sizes=\"(max-width: 562px) 100vw, 562px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5ce704f4f04a15bfee13264103ea3402/6e88f/azure-ml-studio-logo.png\"\n            alt=\"*Azure ML Studio* Logo\"\n            title=\"*Azure ML Studio* Logo\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>Machine Learning (ML) in the age of cloud computing has become ubiquitous. Many of the ML resources on the net go over the concepts of training, or theory behind the algorithms. This is vital if you plan to create a succesfull ML model. </p>\n<p>However, as engineers it is also crucial to put the results generated by our machine learning model at the hands of our users. For that we need a scalable and reliable architecture that can be reused across many products. This post will go over a sample custom architecture that might fit your needs.</p>\n<h1>The requirement</h1>\n<p>The purpose of this architecture is to create a product that enables the Operation and Maintenance (O&#x26;M) personnel of a manufacturing plant to know how the energy demand of a chilled water HVAC system will behave in the near future (~ 15 days). This will allow the team to plan operational changes that can result in energy savings.</p>\n<p>After a brainstorming session with the stakeholders, the following requirements needed to be met by the architecture to fulfill the MVP:</p>\n<ol>\n<li><em>Predict the energy demand of a chilled water HVAC system at any point in the near future (15 days).</em></li>\n<li>\n<p><em>Present the predicted data to two types of stakeholders:</em></p>\n<ul>\n<li><strong><em>Business stakeholders</em></strong> <em>need to access the data in a user friendly format, i.e. Excel or Microsoft Power BI, to make decisions based on the predicted energy cost.</em></li>\n<li><strong><em>Technical stakeholders</em></strong> <em>need to integrate the prediction to their proprietary systems, i.e. Building Management Systems (BMS), to make operational changes that can result in energy savings.</em></li>\n</ul>\n</li>\n<li><em>Have the ability to improve the ML model as the independent variables on which the model was trained evolve through time.</em></li>\n<li><em>Have the ability to extend the architecture to predict other O&#x26;M related data points as the product grows.</em></li>\n</ol>\n<h1>The architecture</h1>\n<p>This is an overview of the proposed architecture. It will be hosted entirely in Azure. I will go over each of its components and their role, as well as give a brief description of why each of the Azure resources used was chosen.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABJ0AAASdAHeZh94AAACHUlEQVQoz3VT2ZaaQBT0/z8gH5GXvOUxc7KNo0bFbURc2WRTQQFRlK6pZlxi5qSP99DSfevWvVVU8O8Sgj9x2Yp7yBdFAbFcwut0sGy14LTb2GsasN+X5/Je5SPeHQyX/e2MiTB0IM/h6TrSKAJWKwjfu935APg3qFw5Wcko5J/TqWR45nYThjjKe2kKEQQQWYpzmqDy3/Z2O4SjEea1GvSXFwSKApgmMoa+jUhUh8Z2ndkMYtBH7WcD1nPtHfDWnoyieC9gmAhWAea2AYXzUgkY8blZzDHNYqgE+lWvY6aNkTdq+PJjgO5T/bHl4hKyJazWcAc92Eofdv0PNkxOGg2chhr2Yw3bXg+ZquL0+gp4Hor1GmffRyXLMmQc9nGxgNvtwiETu9VEPhljr3ThPn9G2qsi7g7gtRrYdb+Xwux6fZxmU4CA4ni8i+IR1TMMxDwY6QECd4VDkiBpNxEO57DWVRiOCtMPoS9nWLpfkTMxPhzKJ5gvSOrRNrICaRt+AIsqrsm4IOOjOoQfxQj4fk81TRYeqwO4vBNTtHLajlMCXj1cKRVlNQlgctBKtYoOh3/gjLY08MKy0KGBdZ6HtMrvEQtbNDdBt+wkp9oyXzwASqXJUNh2yVS2AbLJGSnPEiZIoaLsiE/NBPY2gzbR0JtMsBuPyw5vgLj67mrqS5SLgJBFyOYwncKiH7WnbxSnhTMZH9hRIT89afgL4Bt+q4zzMBsybgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/fecd79cc92566818dc1a500eded9515c/ba381/ml-architecture-diagram.webp 200w,\n/static/fecd79cc92566818dc1a500eded9515c/7f61c/ml-architecture-diagram.webp 400w,\n/static/fecd79cc92566818dc1a500eded9515c/d00b9/ml-architecture-diagram.webp 800w,\n/static/fecd79cc92566818dc1a500eded9515c/92f8c/ml-architecture-diagram.webp 1200w,\n/static/fecd79cc92566818dc1a500eded9515c/58c45/ml-architecture-diagram.webp 1561w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/fecd79cc92566818dc1a500eded9515c/772e8/ml-architecture-diagram.png 200w,\n/static/fecd79cc92566818dc1a500eded9515c/e17e5/ml-architecture-diagram.png 400w,\n/static/fecd79cc92566818dc1a500eded9515c/5a190/ml-architecture-diagram.png 800w,\n/static/fecd79cc92566818dc1a500eded9515c/c1b63/ml-architecture-diagram.png 1200w,\n/static/fecd79cc92566818dc1a500eded9515c/2bcd1/ml-architecture-diagram.png 1561w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/fecd79cc92566818dc1a500eded9515c/5a190/ml-architecture-diagram.png\"\n            alt=\"Diagram depicting ML architecture\"\n            title=\"Diagram depicting ML architecture\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1>The components</h1>\n<h2>ML Engine</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 225px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAABJ0AAASdAHeZh94AAAClUlEQVQ4y6VU30tTURy/L+FLBb33Ev0DSg8LEnw0fNC6tjYZw8ligpW+FUSIMMGwUdtYMRHZ3A/ZFjmjECmCEjJCyW0uY14VbSqN/bjbmG737pz77Zw7cRuzJz98uPfL95zPPd9f5zJQD0kGxpjYCCFin/ihAQycATViUSTc5bgdjuPW1wHjlaWl1MEBWSnk89lEgm4gEQkCpRxIVYzkUI1mM2swjNrtiUJhxGp9HQi8cDrH7Habz/dscnLYYskfHp5kURVLwSCMj+8MDq7pdCGt9o9s/Nbf+8yyL5ubOYMh2tf3jWVFoxGmp6FYrBGTY9vawGQCjwfcbvp0OMA3A2/9MOMFlwvcLur3eqm/tRVIXlUxyUephGyWRIMlCcm+WAG5t/K/sgJNSgJMj6CpQX8/hEL1YpaFZLJiI0Ekb9NClLk98WR2lfpKApTLtFQEvb0QDjeIeb7SU4RpPWxfNhit8+n7CLHLSDrOjkCnaxB3d+N0WpTLWJbFpq/bzP2gZXGbriN8ithPEAj4vd6AQuGbmlJrNOHIGln4Hs+df75ya3YrGNl/F96TeylV2lsVZwh4PpNI8J2dyc3NaCwmiaXNjHDZFlZ4uIyAr419bHoQWN5N04PR/8OW5JxzR+INT+zC+LLlw+qPEKe1fWIG/FdH5v/maG+lWjGWy49LJcyyKEU/nz0Sr1h/nusyNbUMMC0PL14fYm6OXhp6E8/Q2cKnn0z6zPOVu+NY3HhknhuemB+2Uz62zL1aoI2VKgXT6yESqRd3dEA8TuculwOxKAeIq0QC5POUpNsqVf2QEBBXVxdoNNDTI95Vle4oaykoVcRPqVZDezvs7dWLyfSkUpBOE+JUGiVTtcTJ4yW6R75YZ/0Z/AMjUcgcl3ScHwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/713e30ea54c3c4a509a10fce1d38b847/ba381/ml-architecture-ml-engine.webp 200w,\n/static/713e30ea54c3c4a509a10fce1d38b847/d7e55/ml-architecture-ml-engine.webp 225w\"\n              sizes=\"(max-width: 225px) 100vw, 225px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/713e30ea54c3c4a509a10fce1d38b847/772e8/ml-architecture-ml-engine.png 200w,\n/static/713e30ea54c3c4a509a10fce1d38b847/3684f/ml-architecture-ml-engine.png 225w\"\n            sizes=\"(max-width: 225px) 100vw, 225px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/713e30ea54c3c4a509a10fce1d38b847/3684f/ml-architecture-ml-engine.png\"\n            alt=\"ML Engine\"\n            title=\"ML Engine\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\nThe ML Engine is the enabler of our architecture. <em>Azure ML Studio</em> was chosen to be used to create and train the models since it is a very powerful tool with a low barrier of entry which enables analytics through Jupyter notebooks and has a vast collection of ML algorithms to choose from.</p>\n<p><em>Azure ML Studio</em> allows us to expose an API that will be consumed by the prediction workflows, and also enables to retrain and redeploy the model when needed. Therefore, it is possible to iterate and improve the prediction as the independent variables (weather data and space occupation) change over time. This helps to meet requirements <em>(1)</em> and <em>(3)</em>.</p>\n<h2>Prediction trigger</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 430px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABJ0AAASdAHeZh94AAACO0lEQVQoz02SbU/aUBTH+awmfoMtMTExvnC+8rUxMeKUvdqW+LRNqGBbWtCUlAcd0NIVSx9pS1sopdRCe3ZxmeHmn5Nzbs7v3nPOvRkASGG1xmHYVRTD9/vDoeq6muc58zlyTN83p9NJFL1nvq8MsGxaKgFN+dfX+O7uj48fbre2Sjs72PZ27eCgsr9/srmZ3djgjo6gWk0JAlCybaNT0iTJwN5eUn2ISDKm6CXDJAyT0vSSJBOKWtlyObq/X5DkgiBmhcLi8RGy2fTyclXCcpmBL7kJgBTERSlk7ISfvfZNU3Y9xXVlJMdRPQ9ZxfP6lqXPZtDtwu1tCKArSgZOT2YA1Eu7pXcYlWWVoTIYiL2ewHEvoogk8Pw/h2+3DdeF5+f44qIhCH94HsHZGKCmPY3Dbs957FqjwYt0VyziOE7TdKVSKRaLyKKwTBDGeAwcZ5+d/Zakt4Fls6vBpelKAFEU6breaDQQSVEUy7IIzufzCG41m3YQoLKd8/O2LL/Bp6cBgDGNOkbgzheqF+iqMhqNRFFEWLlcxjAMkbZtq+gh324ercPaPBHs6demydshamsoS6ZhDDVNlWVNlnVkFcUyDFWSdMeBTmcNzn12APIWqUdPJeuu7cemP5HHE8339SDQp9N3DVzXimMQhFEu9x/e//RaItyfVwF2E5Z+hTgFlUqK40sMW6wJhctCAX0BNKO1njkufahCsyVeXTOHR63jY+bwUPr+Der1lGGgVlvXaqded/r9Nsch+C9QaGZdyQ7l6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6bbca3c6f6635a9c4031bde10abb5104/ba381/ml-architecture-prediction-trigger.webp 200w,\n/static/6bbca3c6f6635a9c4031bde10abb5104/7f61c/ml-architecture-prediction-trigger.webp 400w,\n/static/6bbca3c6f6635a9c4031bde10abb5104/866c5/ml-architecture-prediction-trigger.webp 430w\"\n              sizes=\"(max-width: 430px) 100vw, 430px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6bbca3c6f6635a9c4031bde10abb5104/772e8/ml-architecture-prediction-trigger.png 200w,\n/static/6bbca3c6f6635a9c4031bde10abb5104/e17e5/ml-architecture-prediction-trigger.png 400w,\n/static/6bbca3c6f6635a9c4031bde10abb5104/05ed2/ml-architecture-prediction-trigger.png 430w\"\n            sizes=\"(max-width: 430px) 100vw, 430px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6bbca3c6f6635a9c4031bde10abb5104/05ed2/ml-architecture-prediction-trigger.png\"\n            alt=\"Prediction trigger\"\n            title=\"Prediction trigger\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\nA way of regulary triggering the prediction job is needed. The trigger can either be scheduled-based to keep the prediction updated, or any other business rule, e.g. whenever a user books a meeting room that will change the space occupation and therefore increase the AC load. </p>\n<p>For this purpose, an <em>Azure Logic App</em> will be used for every data point. If the business rules to trigger the prediction are updated (or new ones are required), a new <em>Logic App</em> can be created very quickly through the <em>Azure Portal</em>. This helps to meet requirement <em>(4)</em>.</p>\n<h2>Prediction processing</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 614px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABJ0AAASdAHeZh94AAACVElEQVQoz4VTS0/bQBD2z+u9/6OnnvsTeqyUFPdQVAQSIATkYSd2bJHUFSKNlLSlkODgJH4kdh4mMbbX3tmOE0BwQB2Nx7Oz882sx99yoKrs6Gh+cKDncgOeN7a2bnK5fj5v8DxGhl+/slIJJImhALCXwrFqlc3nT3sUICSE4uopJU1ZsfgKWFHYbIbhlJCZ615fXrYuLm513R2PIU0pIglhlcor4Fpt05lS6vu+bduTycR13fnmOJvOovgf8DotRdtut5MkYc+P/QjGBvBoH8CwPjY8hnRdx+11crYGLPRaZypJoePEFMKIxDFBub+/j9devH5FQZCWSlluGJ4XCl1Na4piR5IT3+egJocTtx8kTdO/ma1My7YtfDKx0HEcnCIVhAxcKNi7u8a3nc5nfrS3R/f3uaBUDBz3r293p622c/uz1ZZlqV6va5qmKMp3TRsZRlgoRKvV6uQEK2y3rE8/htkoqhL3i+cXgwEOiiRpGJOrq6tGo1Gr1QRBqFQqF81mv9frb28but77wl/3jffF3rudcy+mTJY4kKVw7HbvIm3g/RnPbGdsGEa93pBlGcfuet7EsqgoUpIwSTyfJm8/lt582BVGAaurGThyvO7CHM5bv23dGtkTxzaHQ1TbNC3T9BBcLm++mQll9EEoM6nKDg85qFaj6ZQwlgCgjQG8xSKiFJ1MGYuQrRt6EgLLJQsCQEUnjjmGlY6P4ewMFIUiVVW1lc8neBNUFSN4bQC5eXrK1hx88ZcBOIYc8P2NwmLBlst+p0ORc3d3D3EMPifcM/kHg/0tKMbLfmEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6d1d789132c9368ddc41ca591ecb9e91/ba381/ml-architecture-prediction-processing.webp 200w,\n/static/6d1d789132c9368ddc41ca591ecb9e91/7f61c/ml-architecture-prediction-processing.webp 400w,\n/static/6d1d789132c9368ddc41ca591ecb9e91/5316f/ml-architecture-prediction-processing.webp 614w\"\n              sizes=\"(max-width: 614px) 100vw, 614px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6d1d789132c9368ddc41ca591ecb9e91/772e8/ml-architecture-prediction-processing.png 200w,\n/static/6d1d789132c9368ddc41ca591ecb9e91/e17e5/ml-architecture-prediction-processing.png 400w,\n/static/6d1d789132c9368ddc41ca591ecb9e91/e9131/ml-architecture-prediction-processing.png 614w\"\n            sizes=\"(max-width: 614px) 100vw, 614px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6d1d789132c9368ddc41ca591ecb9e91/e9131/ml-architecture-prediction-processing.png\"\n            alt=\"Prediction processing\"\n            title=\"Prediction processing\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\nThe actual creation of a data point prediction happens through a request to the <em>Azure ML Studio</em> API. However, because each data point may require information on independent variables retrieved from other sources - such as the latest weather prediction, or calculating the space occupation - a way to easily coordinate dependencies is needed. A <em>Logic App</em> provides the best way to understand how a certain data point is predicted.</p>\n<p>As more data point predictions are added to the product, we can add their corresponding triggers and prediction workflows as a new <em>Logic App</em>, meeting requirement <em>(4)</em>.</p>\n<h2>Prediction caching</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 793px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAABJ0AAASdAHeZh94AAACHklEQVQoz12SbVPaQBDH+YrtB+kLP4z9Au1Mi9VhOjoKFkRSGSLyIAlgUEzIw+XuCAkNhDyQ3HUD6HS6sy/29u63/91NCvz0lDdbZvE4rpzyWj0pl7Pr6/XFhfHtu3t2ToolVq2yWo3X69bJSVyp8JsbiHmxyD2vwB1XTbaB8lGl/XnMdYearju10cxZr//88BbFlHPGMs65RUicJHxv4zGntKA/ysLrLJocPUyk/mjaf2j3u90XRUF0sabHm/nnLTzN0hw2jDgMeZYX4pKUw1uMV9tktTLXMQvDYLPZZFlqGIaFbMMe6paMCQmCIIctK47jg7Is57Cvqia2CcYYIc9b7q90XW827/p96f6+0+126XwOSdM0/4exLFPXm1Nqv1mapiCiaZqFLEV5UlWNUgpJqJi8z7yHkSQhSp8nE1EUBUFotVrQOSEkDEMAZuqrjaAUzGssFgugWJaxd9gaDAyMZUkajUbjnUVRhBBaLd0vPe/oHPlb7i+9ma5DEsT12UzH+ABHsMM03cZx8ubwZYL16mWqfvppf/hqta3Yd3C73W7c3lbK5bYoPqvqYdvccfIZGOP/GJwyzkTNLQ7mfhTR5RI5jkEIaFqwHd9nw+EOFgSuKHkbcN55OhikkrQQhI14xzotp9GIuj0my2z3hkkSgz/k6gpUCxwGIGTvDGJQ6HSapVKvXH4Sfj/+qnYuLzeaBnkGbyjNHYJdv38BdKWEEh3xAxUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f6424319b29554b74aa90d8c830313e6/ba381/ml-architecture-prediction-caching.webp 200w,\n/static/f6424319b29554b74aa90d8c830313e6/7f61c/ml-architecture-prediction-caching.webp 400w,\n/static/f6424319b29554b74aa90d8c830313e6/51ddc/ml-architecture-prediction-caching.webp 793w\"\n              sizes=\"(max-width: 793px) 100vw, 793px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f6424319b29554b74aa90d8c830313e6/772e8/ml-architecture-prediction-caching.png 200w,\n/static/f6424319b29554b74aa90d8c830313e6/e17e5/ml-architecture-prediction-caching.png 400w,\n/static/f6424319b29554b74aa90d8c830313e6/73fd0/ml-architecture-prediction-caching.png 793w\"\n            sizes=\"(max-width: 793px) 100vw, 793px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f6424319b29554b74aa90d8c830313e6/73fd0/ml-architecture-prediction-caching.png\"\n            alt=\"Prediction caching\"\n            title=\"Prediction caching\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>The purpose behind having a caching component is multiple. It will allow to limit the number of calls to our ML API, its dependent services and to minimize the number of times that the <em>Azure Logic Apps</em> run.</p>\n<p>Using an <em>Azure Function</em> alongside with <em>Azure Storage Tables</em> to persist the cached data helps to further decrease the cost while keeping the entire infrastructure functional and ready to respond to new requests instantaneously. Therefore, the most complex parts of the architecture only run when needed and not every time an external consumer requests the result of a prediction. </p>\n<p>Another resource that is part of the prediction caching is the <em>Azure Key Vault</em>. Using a key vault to store secrets and configuration values has a lot of advantages that will be covered in future posts.</p>\n<h2>Customer facing API</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 393px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAABJ0AAASdAHeZh94AAACZElEQVQ4y42T7U/aUBTG/Zf96Be/GYKGzGRqeBGq6FyyLVuyEJeMMQwIDejeEiIUWuGW0gqt8mJt6cvt2WkR53RmPjlpTm/P757n3tu7AHNNHMf2vKnnmQAmpQ6OTKdTSnXXxdxy3f54PNR1rPTmyAIMhyAILs8fbm4erKy8DoXehMMY7yORwu4us7z8IRJ5FQrlksmXi4tHDAOyTFstCGZZgNVVSCRgf99lmJtYjDJJj0k5TMpMJLx0Gp84PtjY0ONxmk7D3h4cHMD6OsRiAYyk4/hmAjd9B37qcGHDfXszeX7NrKjvUwjTaJQahue6tmX/UsbfVR2/n/bGQ8MCist1qOO4tk2DhGICQNE5GkGYXVqqsmwh/zX57mNtbLd4Nfuty03sLNf7Ua2UyuxfKpfZkxP28BAp9vT01jZOY1l203TfpkovIl+OVKM3Me/Wcs/63Pb2drDmeBxs+25cs6igO/CUHqz5DsZDPW93znm+R0iHELHbfRbsBfD19XWz2RQEgYgiz/OdTsc0TeORfHowuAdbFmadtq9ut0sIkQOJIrb3hQkOSpLENRqG64KmPeyMRYqiqKqqaRrHcbVa7SwQJo1Go16vo6/62Rn+uaCq/4Cx22AwQMP5fP5zoEwm82kufC0dH/ulj2F0hfDV1VWlUslms3iouVyuUCiUy2WcC5NisXhSrVoPYdM/UrHdlghRJKkvyxe9nhIEJheyPEv6iiI0mwZ2+rNh0eisszoaSZeX8nCI3Z8KSdOc2W7fXoxwGLa2AO8axs7O/wPv1traHB6NgBAQRY+Q5wRW+vU3Nwj/BjWgsiCFgRfOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/54b391646c1a77e39c92aaef70edaa5e/ba381/ml-architecture-customer-facing-api.webp 200w,\n/static/54b391646c1a77e39c92aaef70edaa5e/8efa6/ml-architecture-customer-facing-api.webp 393w\"\n              sizes=\"(max-width: 393px) 100vw, 393px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/54b391646c1a77e39c92aaef70edaa5e/772e8/ml-architecture-customer-facing-api.png 200w,\n/static/54b391646c1a77e39c92aaef70edaa5e/d72ec/ml-architecture-customer-facing-api.png 393w\"\n            sizes=\"(max-width: 393px) 100vw, 393px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/54b391646c1a77e39c92aaef70edaa5e/d72ec/ml-architecture-customer-facing-api.png\"\n            alt=\"Customer facing API\"\n            title=\"Customer facing API\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\nAll of the previous architecture components were inner-facing, meaning that they will only be interacting with each other within the infrastructure. In order to provide a way for our stakeholders to view the results of the energy demand prediction we can create custom HTTP endpoints. These endpoints can provide access control to determine whether a certain stakeholder has access to a specific prediction.</p>\n<p>This can be achieved through the use of <em>Azure API Management</em>, which allows to bundle APIs into products and set up policies to our stakeholders such as usage quotas and user management.</p>\n<p>The API can be consumed by most data manipulation software such as Excel or Power BI. Because it is also exposed as an HTTP endpoint, a request can be implemented on any webpage or called from within a proprietary BMS system, fulfilling requirement <em>(2)</em>.</p>\n<h1>The implementation</h1>\n<p>The resulting implementation of the architecture is depicted in the following diagram. Since the energy demand for the chilled water HVAC system depends on both the weather forecast data and the occupation schedule of the different meeting rooms, the APIs that expose this data need to be queried by the <em>Azure Logic App</em> that controlls the prediction processing for the data point. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACWklEQVQ4y41U227TQBDND/MtfACvPCEkJMQTCKnqSyltVaXO1bHjW3xd2+u7mzjOYXZbhwQixEqjXe/lzMyZMx7hwjgcDpe2sdtuoes65nMN09kSWcaP9wcb/Qk0gPV9j/1+f7Sd+D708qxMblAkt8OrM6ejU/RTQMYYlsslVFWFZRlY+Rk0N0ZZNnCcO5rXEmpw2HXd3xEOY4hOXBLW05qlGfyI0aMeQRhT6iaWswlm0ylRsICmaXh+fsaoqioUWY46L5GmKXa7HfIsw1rXKDILpmnBczfQgxwLh6EqC4RhiCLP8PHBxMpl6Lvdbw55yvE4U3D9dAfXdVEWBXo6yJstkZ4hjhk45+DkNGIxoihCEARo2xbvrxfQ/fQlq1eqZMqflCu8+fz2mHJWl3iydTyOJ/h5dy953O+JI6Iiz3OEvg/HstFvG1mUw0lBJWBeZDAd4wi4JXkw4ivYEC91csavkIoVMjhUtKZppQ2FPALypsMmbYm/Leq6RtvUlDIQbr7ANq9guwls24RPkUVRig3REFec7jUE2JwDijR8xrEwXCRJjKIo5aWirOEFBvzQIxAm+bVsC2X8DVXhkci7i80wcj2PSj+RNiUJOI5zPFypGibKBOPxmKQxR1WVcOzvVH1VOhHFEio5bYrRIMxT7Ym1GCJFw1hDURQJmJIiVJVEvnrRnOQ/jc8j/FcviwiGtXCWJIksik+ySQIXXxUP7+7z8wgvtd4AIgBOMxD7Yo5pv2tr3C5dfPhhUGPw13f/EaHoHinsVxNOChI/5xnmUwXT8YP8AwmnYvwCwX17XLCaOLMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d32d4350b3a5f4c82715a0f0c71120dc/ba381/ml-architecture-diagram-implementation.webp 200w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/7f61c/ml-architecture-diagram-implementation.webp 400w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/d00b9/ml-architecture-diagram-implementation.webp 800w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/92f8c/ml-architecture-diagram-implementation.webp 1200w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/41bb6/ml-architecture-diagram-implementation.webp 1222w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d32d4350b3a5f4c82715a0f0c71120dc/772e8/ml-architecture-diagram-implementation.png 200w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/e17e5/ml-architecture-diagram-implementation.png 400w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/5a190/ml-architecture-diagram-implementation.png 800w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/c1b63/ml-architecture-diagram-implementation.png 1200w,\n/static/d32d4350b3a5f4c82715a0f0c71120dc/636d3/ml-architecture-diagram-implementation.png 1222w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d32d4350b3a5f4c82715a0f0c71120dc/5a190/ml-architecture-diagram-implementation.png\"\n            alt=\"Diagram with implemented ML architecture\"\n            title=\"Diagram with implemented ML architecture\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>For this specific implementation, a report was generated in Excel where the API endpoint <code class=\"language-text\">GET GetLatestPrediction</code> was called through VBA code and where the specific API key on our API product for the end user was passed as a Header. This the generated report for one of the test runs:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC+ElEQVQ4y01TS2tTQRS+/0Ra6kpcKj5XtVR3ClZFKG4sCCIi3QjiQqHQhS4EEYqCuNKlGzdFqaSvNI+bm9Q0rza3eefmcXPfN7k3yeeZadNm4ON8c+Y7Z87MnBEm559h6tFznHu8iOuLb3Bh4QXOrKzirDjAxbCFK1EHV0UHlwmXiF87tudDDia2LUyewMbElglh9uUSGOaXP+LJh8+Yf/sO098DmI07uC/peBg3MBfTcSei4jbhntjB3aiKW2EV02ENM1EDMxEdN4jfjFkQlr/9wNSDBTx9/wlKrYrk3h5KB/tIihFEtrcQC4ewK0YR2txE4M9vrK2uYuPvGmI7QaTjEmLBLSTCO4iHduBbBoQvP39h7tUSXq98RS6Txl4qBaXRgK4bqFSrnJfLFRimCU3XUVcUNJpN1Op18llc02i1cJDPw3YcCBgbnudxm6fFmCRBkuKQ4nEkdnchijGsr28gEAggGKSKEgkkCBLp4qQRRZFvKgyHQzCMD5kSptNpLmaWbZDJZJCgwHA4gmw2i1wuh2wmCykmIUWnSiaTsCzrNOF44na7zcGO1ul0OFdV9YTzNboKZpukYWulUgndbg/CYDAAAzDEiDP4vo9+vw+H7kXTNJ7MMAzuP1rzT/hIy+IEdm82lWq7PlU44BhPzIRMw4I8zz/1DwbHJxqdjooiK5h0kS1VQ6qgo9xgiT2eZDikHckyDr4JWQw4OkYXhbqFWsuGbnXR1lyougu360MwDB3NVocnPKyZXFglIROx5EOqpK1TEAWUGzZKisW1+aqJStPGftlArmTwWDbnFbLXYaV7fh+G7SFdNHhwUaEEjSMU6jZyZZNz5v+X1yHXLNI5VIADuUoVt92jR7FtG71eDx7B9z24bheVhslRVkyq1oZlu3SHPa5zaF0zHOjmqY+9sOX0jhrbdV3IsoxisXiMAgqFQ0KB2qFIP6XE+QhMw/3UKrJ8yOcsnrUP70O2w6ivWvSNWG+xOeeEkW/kH/Fxf72uwKSv+B8SQDkGCTFbCQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/bc036480413fccb8056dc6de7a13c4ad/ba381/ml-architecture-excel.webp 200w,\n/static/bc036480413fccb8056dc6de7a13c4ad/7f61c/ml-architecture-excel.webp 400w,\n/static/bc036480413fccb8056dc6de7a13c4ad/d00b9/ml-architecture-excel.webp 800w,\n/static/bc036480413fccb8056dc6de7a13c4ad/97d4f/ml-architecture-excel.webp 827w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/bc036480413fccb8056dc6de7a13c4ad/772e8/ml-architecture-excel.png 200w,\n/static/bc036480413fccb8056dc6de7a13c4ad/e17e5/ml-architecture-excel.png 400w,\n/static/bc036480413fccb8056dc6de7a13c4ad/5a190/ml-architecture-excel.png 800w,\n/static/bc036480413fccb8056dc6de7a13c4ad/4e6ec/ml-architecture-excel.png 827w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/bc036480413fccb8056dc6de7a13c4ad/5a190/ml-architecture-excel.png\"\n            alt=\"Energy demand chart prediction\"\n            title=\"Energy demand chart prediction\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>In case you wonder how the Azure ML training interface looks like, it is pretty simple (although the training process itself was fairly time consuming). </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 124.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAABJ0AAASdAHeZh94AAADtElEQVQ4y41UW28bRRT2vwJUBBI1jsnNTlM3wY2qIFpREIgnHvrOA2+8FIl3hHigiKrQW9JCFCe+YTvk5kuC68SpY+/u7GV21jt7cWO+2U3SQlPE0dnR7Ox85/KdczYSm0yNJmfGpmbiE6mRiemx5Exs/EJ88uLIJF5T8cSldyemX387dj6eSKXn0/PXXnvzfHQ0OTo1e+2zLyI3vlv4YWF1p16vrG9U1tahG5tbf1TWH2Vyv2Vyj5azWP/c2Nqu1uqNnXpjd3OrulWtVeuNaq0R+Sa/VznQhs8GeiCqqjLGuG3LkgTVVGL3+0dHz4bDI6zBBncHUGwiN+6UlmoHnNGnnY5KiCJLKlEMXSOyAMOWaZqUGhD9RDRNwznnPPLV41q+2R04nJrskOj7XQV6IKsHsqYa1GLMoKaGjcVsG0EIgTFFURzHiXy9vFtsyb5j65Q2O/Lazt7a7t52u7vd7h0qWp8xRadd1XAdIYPBwPM8ZppwLsDf5p4Un/Q83jcoxandtyCUmqHgBP6JLgKXJIlS6jg2SEHwAnxzpVlsST63jQARorDqBoUaBoVnDWZhmjHf9/iL4C8Xa7mmNHCOwafCTqzIutFRNKnXI4QgYZtbz8Ef/7S21Oi8DD41AbYIZbZlgWFk5HrOC+Bblcxf0pHnIEjzLMFxT6OqopiMgTCEDRNgG/jI9VuV3B4Z+m4IZgwq5DhwioQROWojgy3f97kjKJVlGYT/A4zrxECcIQ4WLFRIgA1hDK6Qs+PyM8HGcYaajlZDe4EhuMZrT9HQVrKioM9s/grPAb0sbKOwn1Cinqr3iGhIoqqe5wKMiM7wbDGzJWtEFa1LAj9wouKWrocMi0xEpRjAuPMSYWF5KQ1nANNwSDRJIWgX13WRcN+2cCHIyPw3+HmFTzhXKcMAYYcoUNvgUJAHW68En4qkiYGUehLCt7kdxnbcJP8BDqcCil8Cyi/YskEL+99g3ZA0AxRiNpjVR+jhpxPwj+VsSxkG7Sm6O3zEKnLuEr20s1+otQr1Vqn5dLN1iKKYwTyLP8kntzcLbX04HMC6jbr2uc64w/tBgUS6KM5+u40iux7m0QHlnutybg98P3Ll5s/fL2bLpfLvy6uZlWyuWF7Nl5aWV+7ef/jL3fv3Hiw+XHx8+86v9x4sFIolfC4Uy9l8MbOaL5YqkenLH74/f/2tWHL68tV4Mj12cW4kMfveVHoidWX0wlxy9oPo+KVYYjY+lZ67+ml0PDX/0edvvDN+Ljp5Lpr4Gz3FDyWwWOirAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3a8960fdf3ae7a3de9cda1d2ef84df10/ba381/azure-ml-studio-sample.webp 200w,\n/static/3a8960fdf3ae7a3de9cda1d2ef84df10/7f61c/azure-ml-studio-sample.webp 400w,\n/static/3a8960fdf3ae7a3de9cda1d2ef84df10/d00b9/azure-ml-studio-sample.webp 800w,\n/static/3a8960fdf3ae7a3de9cda1d2ef84df10/5758c/azure-ml-studio-sample.webp 824w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3a8960fdf3ae7a3de9cda1d2ef84df10/772e8/azure-ml-studio-sample.png 200w,\n/static/3a8960fdf3ae7a3de9cda1d2ef84df10/e17e5/azure-ml-studio-sample.png 400w,\n/static/3a8960fdf3ae7a3de9cda1d2ef84df10/5a190/azure-ml-studio-sample.png 800w,\n/static/3a8960fdf3ae7a3de9cda1d2ef84df10/c1c45/azure-ml-studio-sample.png 824w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3a8960fdf3ae7a3de9cda1d2ef84df10/5a190/azure-ml-studio-sample.png\"\n            alt=\"Azure ML Studio Model in training\"\n            title=\"Azure ML Studio Model in training\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<h1>Final thoughts and next steps</h1>\n<p>Some of the next steps that are worth exploring are how the architecture can accomodate a retraining scenario. Currently the retraining would need to be done manually, however we could integrate this as part of a regular workflow since <em>Azure ML Studio</em> exposes an API for this purpose. This could also imply some considerations such as API versioning in case that we introduced breaking changes and needed to support older consumers. </p>\n<p>Sadly enough, although this architecture did come to life as a proof of concept, it was never released as a full product due to technical limitations on the stakeholder side having to do with a lack of monitoring of the energy demand to continue moving forward with the ML model improvement.</p>\n<h1>About the resources</h1>\n<p>If you wish to learn more about the Azure resources used in this architecture, feel free to dive into their documentation:</p>\n<h2><a href=\"https://studio.azureml.net/\">Azure Machine Learning Studio (classic)</a></h2>\n<h2><a href=\"https://azure.microsoft.com/en-us/services/logic-apps/\">Azure Logic Apps</a></h2>\n<h2><a href=\"https://azure.microsoft.com/en-us/services/api-management/\">Azure API Management</a></h2>\n<h2><a href=\"https://azure.microsoft.com/en-us/services/functions/\">Azure Functions</a></h2>\n<h2><a href=\"https://azure.microsoft.com/en-us/services/key-vault/\">Azure Key Vault</a></h2>\n<h2><a href=\"https://azure.microsoft.com/en-us/product-categories/storage/\">Azure Storage</a></h2>","excerpt":"Machine Learning (ML) in the age of cloud computing has become ubiquitous. Many of the ML resources on the net go over the concepts of training, or theory…","frontmatter":{"date":"07 June, 2021","path":"/blog/predict-energy-demand-machine-learning-architecture","title":"Predicting energy demand: A machine learning architecture"},"fields":{"readingTime":{"text":"7 min read"}}}},"pageContext":{}},"staticQueryHashes":["3000541721","3649515864"]}