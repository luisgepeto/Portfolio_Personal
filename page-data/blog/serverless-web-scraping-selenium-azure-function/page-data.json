{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/serverless-web-scraping-selenium-azure-function","result":{"data":{"markdownRemark":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 593px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABJ0AAASdAHeZh94AAABuklEQVQY02PY+3jLxntLN99fseXBqo33lm99sPrnn5//////B4So4B9M6B+MyRC4zdpopbjVGnnDFWJqSzinXu54/+Pt7z+/gHIXL168d+8ekPH371+QeiD48/7vo6r/T6b/A5n1jyFuj6f1WgXbdSqtZ0qX3pyx+/Hm9jPlEKuioqO6urqAjN+/fwP13f/0/83zxf+PMTy7s/7pF5ALGKJ2uSbu9Y3f41V6NOn48/22a5UbzuSfP3lx2fJllpaW0dHRq1atun3zxv1PP/fe/fDzhvP/o+Kf7y/Ydfv1808/GBpPFV54fartTFnQNmugnY7rNDovVkzqmWxtYy0tLa2pqWljY7N508aNd788evvm/8d5v87I/n+16Orb/ztuvWAoOBy79OZMYIABQ+7ki0OlR5NrTmRBnB0SEtLR0QFi/f3z5sv3rbe/fP189f/T5lff/+++8+r3338MGftDJl5omnixqeJ42qyrvXbrVKuOZUA0t7a2At0M8vOfP0Affvj5/9PL7f9/P3v34//XX79Bob3w+pTplzsnX2zpPV8780p33/n6nQ83gCMGJar+gdH/v1+BGMIFAgCygW8f/+N6YgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e45dfbbef2f2c65748b54cb2e195ff8f/ba381/serverless-web-scraping-selenium-azure-function.webp 200w,\n/static/e45dfbbef2f2c65748b54cb2e195ff8f/7f61c/serverless-web-scraping-selenium-azure-function.webp 400w,\n/static/e45dfbbef2f2c65748b54cb2e195ff8f/ee627/serverless-web-scraping-selenium-azure-function.webp 593w\"\n              sizes=\"(max-width: 593px) 100vw, 593px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e45dfbbef2f2c65748b54cb2e195ff8f/772e8/serverless-web-scraping-selenium-azure-function.png 200w,\n/static/e45dfbbef2f2c65748b54cb2e195ff8f/e17e5/serverless-web-scraping-selenium-azure-function.png 400w,\n/static/e45dfbbef2f2c65748b54cb2e195ff8f/0b5b1/serverless-web-scraping-selenium-azure-function.png 593w\"\n            sizes=\"(max-width: 593px) 100vw, 593px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e45dfbbef2f2c65748b54cb2e195ff8f/0b5b1/serverless-web-scraping-selenium-azure-function.png\"\n            alt=\"Selenium and Azure Functions Logo\"\n            title=\"Selenium and Azure Functions Logo\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>A serverless approach to web scraping offers advantages such as scalability and reduced cost. However, the need for external depedencies such as the browser introduces additional configuration complexity. We will be using <a href=\"https://selenium.dev\">Selenium</a> (a popular browser automation tool) inside an Azure Function to retrieve weather information from a publicly available website.</p>\n<h3>A word of advice</h3>\n<p><a href=\"https://parsers.me/us-court-fully-legalized-website-scraping-and-technically-prohibited-it/\">Web scraping is a controversial subject</a>. Before moving forward with any project that uses this technique please be aware of your local regulations, as well as copyright or Intellectual Property implications for the scraped data. Also, implement an ethical web scraping with practices such as:</p>\n<blockquote>\n<ul>\n<li>Respect the site's <code class=\"language-text\">robots.txt</code></li>\n<li>Respect the provider's Terms of Service</li>\n<li>Do not DoS websites with multiple requests</li>\n<li>Identify your scraper with an appropriate <code class=\"language-text\">User-Agent</code> request header</li>\n</ul>\n</blockquote>\n<h1>Selenium</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABJ0AAASdAHeZh94AAABLElEQVQY022Qy0pCYRSF/5FzH8GxAwc+gVOnPoVDH8OJ4NCxIBiCaF7SCo3USEIhUAQ1w9LjPTXNo+fy5fmhBtEHm81ag7Uvwpa1ITICcSlIjBNYmKbJRtvwg2Zq/EU3df5DiKTAWXYSfgnjf/Yz2A+oLCv0dr1zMuz1PY11g4N+QNVVttqWzWnD/DiXoSfjJL3VcSW7CLQCuO5c+J582K/sKKpCe9umtW0Re4+RUlJkJxnio7jUpUWJwqxw1heMD2Ou5zdkp1mSSpLIawQRfYsS7AUJ9UO4790Mv4aMDiPSkzS5aY7OZ4faqkZ5Uab+UZcDm+umDKouq+Snefr7Pt1dl+KsiLA28zx48D56cdw6ZJhqqLIsrJMtLH00jvK/hmlIb6ft0Azt17PqG0kvWQ1Wfry3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/79b4bb19e6c3ba0680e0be6869405dd5/ba381/selenium-logo.webp 200w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/7f61c/selenium-logo.webp 400w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/d00b9/selenium-logo.webp 800w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/92f8c/selenium-logo.webp 1200w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/1d10f/selenium-logo.webp 1225w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/79b4bb19e6c3ba0680e0be6869405dd5/772e8/selenium-logo.png 200w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/e17e5/selenium-logo.png 400w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/5a190/selenium-logo.png 800w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/c1b63/selenium-logo.png 1200w,\n/static/79b4bb19e6c3ba0680e0be6869405dd5/85053/selenium-logo.png 1225w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/79b4bb19e6c3ba0680e0be6869405dd5/5a190/selenium-logo.png\"\n            alt=\"Selenium Logo\"\n            title=\"Selenium Logo\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>Simply put, Selenium is a tool that allows to code regular interactions with a browser. By using Selenium, it is possible to simulate simple actions such as page reloads or user clicks. However, more powerful functionality is also available such as inspecting the DOM or simulating keyboard events.</p>\n<p>Selenium is mainly used in automated web testing to ensure multi-browser compatibility. However it can also complement Test Driven Development (TDD) practices, and can <a href=\"./docker-supercharge-continous-integration\">improve your Continous Integration (CI) workflow</a> by integrating a Selenium based test suite on your test pipelines.</p>\n<h2><em>WebDriver</em> &#x26; browser</h2>\n<p>To use Selenium in your project you need to download the <em>WebDriver</em> for the browser of your choice. The <em>WebDriver</em> is an executable which needs to be added to your system's PATH whose purpose is to emulate the user's interaction with the browser. There are multiple <em>WebDrivers</em> available for most browsers (Chrome, Firefox, etc). You can find all the <a href=\"https://www.selenium.dev/documentation/en/webdriver/driver_requirements/#quick-reference\">supported <em>WebDrivers</em> in the Selenium documentation</a>.</p>\n<p>Since the <em>WebDriver</em> runs against the browser, we also need to have it installed on the target machine. These last two requirements are specially difficult to achieve in a serverless architecture, since these platforms do not offer a higher degree of environment configurability. </p>\n<h2>Building a customized Selenium + Azure Functions enabled Docker image</h2>\n<p>We need to guarantee that the Selenium dependencies are side loaded whenever our code executes. Because we will be using an Azure Function, we can create a Dockerfile based on the latest Azure functions Docker image and then install the Selenium dependencies.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Using the latest .NET Azure Functions Docker image as our base</span>\n<span class=\"token keyword\">FROM</span> mcr.microsoft.com/azure<span class=\"token punctuation\">-</span>functions/dotnet<span class=\"token punctuation\">:</span>3.0 AS selenium<span class=\"token punctuation\">-</span>install\n\n<span class=\"token comment\"># Install Selenium according to: https://github.com/rebremer/azure-function-selenium/blob/master/Dockerfile</span>\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get update \\\n    &amp;&amp; apt<span class=\"token punctuation\">-</span>get install <span class=\"token punctuation\">-</span>y \\\n        build<span class=\"token punctuation\">-</span>essential \\\n        cmake \\\n        git \\\n        wget \\\n        unzip \\\n    &amp;&amp; rm <span class=\"token punctuation\">-</span>rf /var/lib/apt/lists/*\n\n<span class=\"token comment\"># Installing Chrome</span>\n<span class=\"token keyword\">ARG</span> CHROME_VERSION=<span class=\"token string\">\"google-chrome-stable\"</span>\n<span class=\"token keyword\">RUN</span> wget <span class=\"token punctuation\">-</span>q <span class=\"token punctuation\">-</span>O <span class=\"token punctuation\">-</span> https<span class=\"token punctuation\">:</span>//dl<span class=\"token punctuation\">-</span>ssl.google.com/linux/linux_signing_key.pub <span class=\"token punctuation\">|</span> apt<span class=\"token punctuation\">-</span>key add <span class=\"token punctuation\">-</span> \\\n  &amp;&amp; echo <span class=\"token string\">\"deb http://dl.google.com/linux/chrome/deb/ stable main\"</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> /etc/apt/sources.list.d/google<span class=\"token punctuation\">-</span>chrome.list \\\n  &amp;&amp; apt<span class=\"token punctuation\">-</span>get update <span class=\"token punctuation\">-</span>qqy \\\n  &amp;&amp; apt<span class=\"token punctuation\">-</span>get <span class=\"token punctuation\">-</span>qqy install \\\n    $<span class=\"token punctuation\">{</span>CHROME_VERSION<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>google<span class=\"token punctuation\">-</span>chrome<span class=\"token punctuation\">-</span>stable<span class=\"token punctuation\">}</span> \\\n  &amp;&amp; rm /etc/apt/sources.list.d/google<span class=\"token punctuation\">-</span>chrome.list \\\n  &amp;&amp; rm <span class=\"token punctuation\">-</span>rf /var/lib/apt/lists/* /var/cache/apt/*\n\n<span class=\"token comment\"># Getting the latest Chrome version and installing the appropriate WebDriver</span>\n<span class=\"token keyword\">RUN</span> LATEST=$(wget <span class=\"token punctuation\">-</span>q <span class=\"token punctuation\">-</span>O <span class=\"token punctuation\">-</span> http<span class=\"token punctuation\">:</span>//chromedriver.storage.googleapis.com/LATEST_RELEASE) &amp;&amp; \\\n    wget http<span class=\"token punctuation\">:</span>//chromedriver.storage.googleapis.com/$LATEST/chromedriver_linux64.zip &amp;&amp; \\\n    unzip chromedriver_linux64.zip &amp;&amp; ln <span class=\"token punctuation\">-</span>s $PWD/chromedriver /usr/local/bin/chromedriver\n\n<span class=\"token comment\"># Adding the Chrome WebDriver to out system's PATH</span>\n<span class=\"token keyword\">ENV</span> PATH=<span class=\"token string\">\"/usr/local/bin/chromedriver:${PATH}\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1>Azure Functions</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 203px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABJ0AAASdAHeZh94AAAC4ElEQVQ4y32Uy08TURTGG0ig2miCRONrZ8JONy78E4iPGEk0caOJcaXR6FKDhBgTE3ca3RoRUDf4AmIKCBR8ILTyqDRA0crDEmkLfVihnfv4PDN3Op0pxJtM53bm3t983znnHhdKhpTSuIy5yEMk30CsNEPEn0FGWyEXH0Mmes21Qv9x7HfZQYW7EFzNs35oYx5oEx7wj1shvW4IbxnEcoe5llv7HMDCQ2G9FNBnPNpAQDfYxD4I3x6CVQDhG8YKbnxUOsQYwFKYxjnCiTValQObOkLqtoMP74bo8gBDh5H8k8TPZN6ESpQ6dJW+uNIRxP0vMSA3iNzYNrAgwXzV4N5KYMWLpSxQ1zqED3OrxnomhCNcLjvscvsk6rtD6usL16CNu8EDeyG7KiHDDRQINb7FGY49HUZ/ZMWESqdC3e7FV0Hc6plWO/gqtNBBslsFMbATsnsH5OQlyNnbYKHrQKwFU4kcap8MwxuOOewbCs+3jRNsxgoyT74ldR6wMUrEQLW6+iooji7KdBlYrMdYN5vIoLZpBJ3TyxbUdeHlBBp7w1YZ6LZ45Cy00XKCVpHKamjBXRTL/RDv3ZBzD5VNrhn3aHqd7I/g3YxS6jr9/Cvu9M+amYZRgzLTSwX9GoLuPNpIwCqqwy2QgbpCoRjJ0Ec8m8dRArZP/VbA1LqG481+C6rH1l6qPHoTzF8OMXgAcm3eVMcsdSda/OiwW9Yn6RzDqdYA7vq+m1CmwCxBtXgI3FcOudSmNplWfxHsZEuAlBVhRtkwMzvZPMeZF6O4N/jDNEX2M16wIUpE6KrtdACLKQUrKNtQNoWUa1wYGX/wSSnVIufolNTQ5K9ZgxJLGQXr3ARmKCz8KUDT63n0RdL0luyO1lidRQgVt4XUGj7PrzpsOo6evV2p86xsiXgTRKTeiqmzeWx+jovdxnqo4FxvYUuPKCkZW48sbi7A7GI29ENHT2QpyPxysYmWqPjf+Ae2syVnp/OMwAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/15c1b8cfd6df74f1c6bbfad196db2920/ba381/azure-functions.webp 200w,\n/static/15c1b8cfd6df74f1c6bbfad196db2920/cb011/azure-functions.webp 203w\"\n              sizes=\"(max-width: 203px) 100vw, 203px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/15c1b8cfd6df74f1c6bbfad196db2920/772e8/azure-functions.png 200w,\n/static/15c1b8cfd6df74f1c6bbfad196db2920/2efce/azure-functions.png 203w\"\n            sizes=\"(max-width: 203px) 100vw, 203px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/15c1b8cfd6df74f1c6bbfad196db2920/2efce/azure-functions.png\"\n            alt=\"Azure Function Logo\"\n            title=\"Azure Function Logo\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></p>\n<p>Azure Functions are Microsoft's serverless solution. They offer multiple advantages such as less infrastructure overhead, reduced costs (since they are billed per execution) and auto-scaling. Azure Functions allow developers to focus on what matters most - the business logic - and empower them to deliver value faster to the application users.</p>\n<h2>Using Selenium</h2>\n<p>In order to use Selenium we need to install its matching libraries. This is as easy as running <code class=\"language-text\">dotnet add package Selenium.WebDriver</code>. Once this is done, it is possible to use our libraries to create an instance of the <em>ChromeDriver</em> class which will use the downloaded Chrome <em>WebDriver</em> and interact with our browser.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">ChromeDriver</span> <span class=\"token function\">GetChromeDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> chromeOptions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ChromeOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// If you wish to see your browser window, you can remove the --headless flag</span>\n    chromeOptions<span class=\"token punctuation\">.</span><span class=\"token function\">AddArgument</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"--headless\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token comment\">// Add this flag if Chrome crashes when opening large pages https://developers.google.com/web/tools/puppeteer/troubleshooting#tips</span>\n    chromeOptions<span class=\"token punctuation\">.</span><span class=\"token function\">AddArgument</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-dev-shm-usage\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ChromeDriver</span><span class=\"token punctuation\">(</span>_driverLocation<span class=\"token punctuation\">,</span> chromeOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Now that we have our <em>ChromeDriver</em> available, we can use it to navigate to our local weather webpage and retrieve the historical weather:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-csharp line-numbers\"><code class=\"language-csharp\"><span class=\"token keyword\">public</span> <span class=\"token return-type class-name\">List<span class=\"token punctuation\">&lt;</span>WeatherInformation<span class=\"token punctuation\">></span></span> <span class=\"token function\">GetDailyWeatherHistory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WeatherStation</span> station<span class=\"token punctuation\">,</span> <span class=\"token class-name\">DateTime</span> localDate<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">using</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">var</span></span> driver <span class=\"token operator\">=</span> <span class=\"token function\">GetChromeDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// We wait for the browser to open before navigating to our page</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> pageLoadWait <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">WebDriverWait</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> TimeSpan<span class=\"token punctuation\">.</span><span class=\"token function\">FromSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Our June weather data lives in http://example.com/history/monthly/MYSTATION/date/2021-6</span>\n        driver<span class=\"token punctuation\">.</span><span class=\"token function\">Navigate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GoToUrl</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$@\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">_uri</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">/history/monthly/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">station<span class=\"token punctuation\">.</span>DatasourceUrl</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">/date/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">localDate<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yyyy-M\"</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// We wait for our page to load</span>\n        _ <span class=\"token operator\">=</span> pageLoadWait<span class=\"token punctuation\">.</span><span class=\"token function\">Until</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> e<span class=\"token punctuation\">.</span><span class=\"token function\">FindElement</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span><span class=\"token function\">ClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"observation-table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// We can search the DOM for our button to switch to metric units</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> metricButton <span class=\"token operator\">=</span> pageLoadWait<span class=\"token punctuation\">.</span><span class=\"token function\">Until</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> e<span class=\"token punctuation\">.</span><span class=\"token function\">FindElement</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span><span class=\"token function\">CssSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#settings a[title='Switch to Metric']\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        metricButton<span class=\"token punctuation\">.</span><span class=\"token function\">Click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// We wait until the DOM element for weather data loads</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> observationTable <span class=\"token operator\">=</span> pageLoadWait<span class=\"token punctuation\">.</span><span class=\"token function\">Until</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> e<span class=\"token punctuation\">.</span><span class=\"token function\">FindElement</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span><span class=\"token function\">ClassName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"observation-table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> measurementTables <span class=\"token operator\">=</span> observationTable<span class=\"token punctuation\">.</span><span class=\"token function\">FindElements</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span><span class=\"token function\">CssSelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"table.days table\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        \n        <span class=\"token comment\">// We can continue traversing the DOM to build our WeatherInformation objects </span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">GetWeatherFromTable</span><span class=\"token punctuation\">(</span>measurementTables<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>Publishing our Azure Function to a Docker image</h2>\n<p>Once we have our code it is time to publish it to Azure so that it can run every night and query weather data. We need to ensure that every time the Azure Function runs it can instantiate a browser and find its appropriate <em>WebDriver</em> on the system PATH.</p>\n<p>We need to use our Selenium + Azure Functions enabled Docker image and publish our compiled code to the <code class=\"language-text\">/home/site/wwwroot</code> directory. This can be accomplished with a different Dockerfile in a <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/#use-multi-stage-builds\">Docker multi-stage build</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-dockerfile line-numbers\"><code class=\"language-dockerfile\"><span class=\"token comment\"># This will be our target image on which code will run</span>\n<span class=\"token keyword\">FROM</span> azure_functions_plus_selenium<span class=\"token punctuation\">:</span>latest as selenium_install\n\n<span class=\"token comment\"># Publishing our application code </span>\n<span class=\"token keyword\">FROM</span> mcr.microsoft.com/dotnet/core/sdk<span class=\"token punctuation\">:</span>3.1 AS build<span class=\"token punctuation\">-</span>env\n<span class=\"token keyword\">COPY</span> . /src/dotnet<span class=\"token punctuation\">-</span>function<span class=\"token punctuation\">-</span>app\n<span class=\"token keyword\">RUN</span> cd /src/dotnet<span class=\"token punctuation\">-</span>function<span class=\"token punctuation\">-</span>app &amp;&amp; \\\n    mkdir <span class=\"token punctuation\">-</span>p /home/site/wwwroot &amp;&amp; \\\n    dotnet publish *.csproj <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>output /home/site/wwwroot\n\n<span class=\"token comment\"># Copying our published code into the target image</span>\n<span class=\"token keyword\">FROM</span> selenium_install\n<span class=\"token keyword\">ENV</span> AzureWebJobsScriptRoot=/home/site/wwwroot \\\n    AzureFunctionsJobHost__Logging__Console__IsEnabled=true\n<span class=\"token keyword\">COPY</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>from=build<span class=\"token punctuation\">-</span>env <span class=\"token punctuation\">[</span><span class=\"token string\">\"/home/site/wwwroot\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/home/site/wwwroot\"</span><span class=\"token punctuation\">]</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1>Next steps &#x26; thoughts</h1>\n<p>Now that our Azure Function code and dependencies live inside a custom Docker image, the last remaining step is to create a new resource in Azure and deploy our code. The quickest way can be to <a href=\"https://docs.microsoft.com/en-us/azure/devops/pipelines/targets/function-app-container?view=azure-devops&#x26;tabs=yaml#configure-registry-credentials-in-function-app\">set the Container settings</a> in the portal. </p>\n<p>Although this specific implementation uses Selenium and its purpose is to build a web scraper, this approach can be reused to bundle any other dependencies that your project might need while keeping all the advantages and flexibility that a serverless approach offers.</p>","excerpt":"A serverless approach to web scraping offers advantages such as scalability and reduced cost. However, the need for external depedencies such as the browserâ€¦","frontmatter":{"date":"13 June, 2021","path":"/blog/serverless-web-scraping-selenium-azure-function","title":"Serverless web scraping: Selenium + Azure Functions"},"fields":{"readingTime":{"text":"6 min read"}}}},"pageContext":{}},"staticQueryHashes":["3000541721","3649515864"]}